# Электронный дневник школы

Этот сайт — интерфейс для учеников школы. Здесь можно посмотреть оценки, расписание и другую открытую информацию. Учителя заполняют базу данных через другой сайт (ставят оценки, замечания, похвалы и т.д.).

## Описание моделей

- **Schoolkid** — ученик. Класс определяется полями year_of_study (год обучения) и group_letter (литера класса), например 10А.
- **Mark** — оценка на уроке (от 2 до 5).
- **Commendation** — похвала от учителя.
- **Chastisement** — замечание от учителя.
- **Subject** — учебный предмет (привязан к году обучения).
- **Lesson** — урок в расписании (включает дату, время, предмет, учителя, класс).
- **Teacher** — учитель.

*Подробнее о полях можно посмотреть в файле models.py*

## Запуск

1. Скачайте код
2. Установите зависимости

```bash
pip install -r requirements.txt
```

3. Создайте БД

```bash
python manage.py migrate
```

4. Запустите сервер

```bash
python manage.py runserver
```

*Откройте сайт по адресу http://127.0.0.1:8000*

## Переменные окружения

Часть настроек проекта берётся из переменных окружения. Чтобы их определить, создайте файл `.env` рядом с `manage.py` и запишите туда данные в таком формате: `ПЕРЕМЕННАЯ=значение`.

Доступны 3 переменные:
- `DEBUG` — дебаг-режим. Поставьте True, чтобы увидеть отладочную информацию в случае ошибки.
- `SECRET_KEY` — секретный ключ проекта
- `ALLOWED_HOSTS` — см [документацию Django](https://docs.djangoproject.com/en/5.2/ref/settings/#allowed-hosts).
- `DATABASE_NAME` — путь до базы данных, например: `schoolbase.sqlite3`

```env
DEBUG=True
SECRET_KEY=your_secret_key
ALLOWED_HOSTS=127.0.0.1,localhost
DATABASE_NAME=schoolbase.sqlite3
```

## Работа с данными через shell

В проекте есть вспомогательные скрипты для массового исправления оценок, удаления замечаний и добавления похвал. Они не предназначены для прямого запуска (как обычные Python-скрипты), потому что для работы с моделями Django необходимо загрузить настройки проекта. Правильный способ — использовать `python manage.py shell`.

## Общая рекомендация по поиску ученика

Все скрипты используют функцию `get_schoolkid_by_name` из файла `schoolkid_utils.py`. Она ищет ученика по части имени (регистронезависимо). Если найдено несколько учеников, функция выведет список и попросит уточнить полное имя.

*Важно: при вызове функций через shell вы будете видеть эти сообщения прямо в консоли.*

**1. Исправление плохих оценок (2 и 3) на 5**

Скрипт: `fix_marks.py`

Пример использования:

```bash
python manage.py shell
```
В открывшейся консоли Django выполните:

```bash
from fix_marks import fix_marks
fix_marks("Иван")  # подставьте имя или часть имени ученика
exit()
```
Функция исправит все двойки и тройки указанного ученика на пятёрки и выведет количество исправленных оценок.

**2. Удаление всех замечаний**

Скрипт: `remove_chastisements.py`

Пример использования:

```bash
python manage.py shell
```
В открывшейся консоли Django выполните:

```bash
from remove_chastisements import remove_chastisements
remove_chastisements("Андреев Лавр Бориславович")  # подставьте имя или часть имени ученика
exit()
```
Будут удалены все замечания для указанного ученика. Функция вернёт количество удалённых записей.

**3. Добавление похвалы по предмету**

Скрипт: `create_commendation.py`

Функция `create_commendation(schoolkid_name, subject_title)` создаёт похвалу для ученика по указанному предмету. Она автоматически выбирает случайный текст похвалы из списка и привязывает похвалу к последнему уроку по этому предмету (дата берётся из урока).

Пример использования:

```bash
python manage.py shell
```
В открывшейся консоли Django выполните:

```bash
from create_commendation import create_commendation
create_commendation("Фролов Иван Григорьевич", "Математика")
exit()
```
Если предмет или урок не найден, функция выведет соответствующее сообщение и ничего не создаст.

**Советы**

- Если вы не знаете точное полное имя ученика, введите часть имени — функция покажет всех подходящих учеников, и вы сможете выбрать нужное имя для повторного вызова.
- Все функции написаны так, что их можно вызывать многократно — они не «сломают» базу данных.
- Для работы в Windows PowerShell не используйте оператор < (например, python manage.py shell < script.py). Вместо этого всегда заходите в интерактивный режим и вызывайте функции вручную, либо используйте однострочную команду с -c, например:

```bash
python manage.py shell -c "from fix_marks import fix_marks; fix_marks('Иван')"
```

## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).
